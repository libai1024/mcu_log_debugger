# 搜索高亮功能说明

## 🎯 功能概述

实现了类似 VSCode 的搜索高亮效果：
- **所有匹配项**：浅黄色背景高亮
- **当前匹配项**：深黄色背景高亮 + 加粗 + 脉冲动画

## 🎨 视觉效果

### 1. 普通匹配项（所有匹配）
```
样式：浅黄色背景 + 淡黄色边框
颜色：rgba(251, 191, 36, 0.35)
边框：1px 淡黄色
效果：清晰可见但不过于突出
```

### 2. 当前匹配项（正在查看的）
```
样式：深黄色背景 + 加粗 + 脉冲动画
颜色：rgba(251, 191, 36, 0.75)
边框：2px 黄色 + 阴影
字体：加粗（font-weight: 600）
动画：1秒循环的脉冲效果
效果：非常醒目，立即吸引注意
```

### 3. 脉冲动画
```css
@keyframes currentMatchPulse {
    0%, 100% { 
        box-shadow: 0 0 0 2px var(--warning);
    }
    50% { 
        box-shadow: 0 0 0 2px var(--warning), 0 0 8px rgba(251, 191, 36, 0.6);
    }
}
```

## 🔧 技术实现

### 1. CSS 类设计

#### `.search-highlight`（普通匹配）
- 背景：`rgba(251, 191, 36, 0.35)`
- 边框：`1px` 淡黄色
- 圆角：`2px`
- 内边距：`1px 2px`

#### `.search-highlight-current`（当前匹配）
- 背景：`rgba(251, 191, 36, 0.75)`
- 边框：`2px` 黄色 + 阴影
- 字体：加粗
- 动画：`currentMatchPulse 1s ease-in-out infinite`

### 2. JavaScript 逻辑

#### highlightSearch 函数
```javascript
function highlightSearch(text, entryIndex) {
    // 判断是否是当前匹配项
    const isCurrentMatch = searchMatches[currentSearchIndex] === entryIndex;
    
    if (isCurrentMatch) {
        // 第一个匹配使用 .search-highlight-current
        // 其他匹配使用 .search-highlight
    } else {
        // 所有匹配使用 .search-highlight
    }
}
```

#### jumpToMatch 函数
```javascript
function jumpToMatch(direction) {
    // 更新 currentSearchIndex
    // 重新渲染表格（更新当前高亮）
    // 滚动到当前匹配项
}
```

### 3. 渲染流程

```
用户输入搜索关键词
    ↓
performSearch() - 查找所有匹配项
    ↓
jumpToMatch(0) - 跳转到第一个匹配
    ↓
renderLogTable() - 重新渲染表格
    ↓
highlightSearch() - 为每个条目高亮关键词
    ↓
当前匹配项使用特殊高亮样式
```

## 📊 使用场景

### 场景 1：搜索关键词
```
用户操作：输入 "ERROR" 并按回车
结果：
  - 所有包含 "ERROR" 的消息都显示浅黄色高亮
  - 第一个匹配项显示深黄色高亮 + 脉冲动画
  - 自动滚动到第一个匹配项
```

### 场景 2：切换匹配项
```
用户操作：点击 "下一个" 按钮或按 Enter
结果：
  - 上一个匹配项变为普通高亮
  - 下一个匹配项变为当前高亮（深黄色 + 脉冲）
  - 自动滚动到新的当前匹配项
```

### 场景 3：多个关键词在同一行
```
消息内容：[ERROR] Connection failed: ERROR_TIMEOUT
搜索关键词："ERROR"
结果：
  - 如果是当前匹配项：
    - 第一个 "ERROR" → 深黄色高亮 + 脉冲
    - 第二个 "ERROR" → 浅黄色高亮
  - 如果不是当前匹配项：
    - 两个 "ERROR" 都是浅黄色高亮
```

## 🎯 与 VSCode 的对比

### 相似之处
✅ 所有匹配项都有高亮标记  
✅ 当前匹配项使用更醒目的样式  
✅ 支持上一个/下一个导航  
✅ 显示匹配计数（1/5、2/5...）  
✅ 自动滚动到当前匹配项  

### 增强功能
✨ 脉冲动画效果（VSCode 没有）  
✨ 支持正则表达式搜索  
✨ 支持大小写敏感/不敏感  
✨ 搜索历史记录  
✨ 搜索时自动锁定视图  

## 🌓 主题适配

### 浅色主题
- 普通匹配：`rgba(251, 191, 36, 0.35)`
- 当前匹配：`rgba(251, 191, 36, 0.75)` + 黑色文字

### 深色主题
- 普通匹配：`rgba(251, 191, 36, 0.25)`（更柔和）
- 当前匹配：`rgba(251, 191, 36, 0.6)` + 黑色文字

## 🚀 性能优化

### 1. 高效渲染
- 只在切换匹配项时重新渲染
- 使用 CSS 类而非内联样式
- 虚拟滚动减少 DOM 节点

### 2. 动画优化
- 使用 CSS3 硬件加速
- 只对当前匹配项应用动画
- 避免 JavaScript 动画

### 3. 搜索优化
- 批量处理匹配项
- 缓存搜索结果
- 增量更新高亮

## 🧪 测试方法

### 基础测试
1. 输入搜索关键词（如 "ERROR"）
2. 观察所有匹配项是否都有浅黄色高亮
3. 观察第一个匹配项是否有深黄色高亮 + 脉冲
4. 点击"下一个"，观察高亮是否正确切换

### 边界测试
1. **单个匹配**：只有一个匹配项时，显示 1/1
2. **无匹配**：没有匹配项时，显示 0/0
3. **大量匹配**：100+ 匹配项时，性能是否流畅
4. **特殊字符**：搜索 `[ERROR]` 等特殊字符

### 模式测试
1. **Log 模式**：在消息列中高亮
2. **Normal 模式**：在原始文本中高亮
3. **HEX 模式**：不支持搜索高亮（HEX 数据）

### 交互测试
1. 搜索 → 切换模式 → 高亮保持
2. 搜索 → 新消息进入 → 高亮保持
3. 搜索 → 过滤日志 → 高亮更新
4. 搜索 → 清空搜索 → 高亮消失

## 📝 快捷键

- **Enter**：跳转到下一个匹配项
- **Shift + Enter**：跳转到上一个匹配项
- **Cmd/Ctrl + F**：聚焦搜索框
- **Esc**：清空搜索（在搜索框中）

## 🎨 UI 元素

### 搜索框
- 位置：侧边栏顶部 + 顶部统计栏
- 功能：输入关键词、正则表达式、大小写切换
- 反馈：实时显示匹配计数

### 导航按钮
- 上一个：`<` 按钮
- 下一个：`>` 按钮
- 显示：当前位置/总数（如 3/15）

### 搜索历史
- 点击历史按钮查看
- 点击历史项快速搜索
- 支持清空历史

## 🔄 与其他功能的集成

### 视图锁定
- 搜索时自动锁定视图
- 清空搜索时自动解锁
- 锁定期间仍可切换匹配项

### 消息选中
- 搜索高亮不影响消息选中
- 可以同时选中和高亮
- 选中状态独立于搜索状态

### 过滤器
- 搜索在过滤后的结果中进行
- 级别过滤 + Tag 过滤 + 搜索高亮
- 三者协同工作

## 💡 用户体验亮点

1. **即时反馈**：输入即搜索，立即看到结果
2. **视觉层次**：普通匹配 vs 当前匹配，层次分明
3. **动画引导**：脉冲动画吸引用户注意到当前项
4. **流畅导航**：平滑滚动 + 自动居中
5. **状态保持**：新消息进入时高亮不丢失

---

**实现版本**：v1.0.1  
**参考设计**：VSCode Search Highlight  
**浏览器兼容**：现代浏览器（Chrome 90+、Firefox 88+、Safari 14+）
