<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCU Log Debugger</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app">
        <!-- Title Bar -->
        <div class="title-bar">
            <div class="app-title">
                <i class="fas fa-microchip app-icon"></i>
                <span>MCU Log Debugger</span>
            </div>
            <div class="header-actions">
                <button class="btn-icon" id="toggleTheme" title="切换主题">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
            <div class="connection-status">
                <span class="status-dot" id="statusDot"></span>
                <span class="status-text" id="statusText">未连接</span>
            </div>
        </div>

        <div class="main-container">
            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Serial Config Panel -->
                <div class="panel">
                    <h3 class="panel-title">
                        <i class="fas fa-plug"></i>
                        串口配置
                    </h3>
                    
                    <div class="form-group">
                        <label>
                            <i class="fas fa-usb"></i>
                            <span>串口</span>
                            <span class="form-hint" title="选择要连接的串口设备">?</span>
                        </label>
                        <div class="port-select-wrapper">
                            <div class="custom-select" id="portSelectWrapper">
                                <select id="portSelect" class="port-select" aria-label="选择串口">
                                    <option value="">选择串口...</option>
                                </select>
                                <i class="fas fa-chevron-down select-arrow"></i>
                            </div>
                            <div class="selected-port-info" id="selectedPortInfo" style="display: none;">
                                <i class="fas fa-link port-icon"></i>
                                <span class="port-name" id="connectedPortName"></span>
                            </div>
                            <button class="btn-icon" id="refreshPorts" title="刷新串口">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-tachometer-alt"></i>
                            <span>波特率</span>
                            <span class="form-hint" title="必须与MCU配置相同">?</span>
                        </label>
                        <div class="custom-select">
                            <select id="baudRate" aria-label="选择波特率">
                                <option value="9600">9600 bps</option>
                                <option value="38400">38400 bps</option>
                                <option value="57600">57600 bps</option>
                                <option value="115200" selected>115200 bps (推荐)</option>
                                <option value="230400">230400 bps</option>
                                <option value="460800">460800 bps</option>
                                <option value="921600">921600 bps</option>
                            </select>
                            <i class="fas fa-chevron-down select-arrow"></i>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label><span>数据位</span></label>
                            <div class="custom-select">
                                <select id="dataBits" aria-label="数据位">
                                    <option value="8" selected>8 位</option>
                                    <option value="7">7 位</option>
                                </select>
                                <i class="fas fa-chevron-down select-arrow"></i>
                            </div>
                        </div>
                        <div class="form-group">
                            <label><span>停止位</span></label>
                            <div class="custom-select">
                                <select id="stopBits" aria-label="停止位">
                                    <option value="1" selected>1 位</option>
                                    <option value="2">2 位</option>
                                </select>
                                <i class="fas fa-chevron-down select-arrow"></i>
                            </div>
                        </div>
                        <div class="form-group">
                            <label><span>校验</span></label>
                            <div class="custom-select">
                                <select id="parity" aria-label="校验位">
                                    <option value="none" selected>无</option>
                                    <option value="even">偶</option>
                                    <option value="odd">奇</option>
                                </select>
                                <i class="fas fa-chevron-down select-arrow"></i>
                            </div>
                        </div>
                    </div>

                    <button class="btn-connect" id="connectBtn">
                        <i class="fas fa-plug"></i>
                        <span>连接串口</span>
                    </button>
                </div>

                <!-- Filter Panel -->
                <div class="panel">
                    <h3 class="panel-title">
                        <i class="fas fa-filter"></i>
                        日志过滤
                    </h3>
                    
                    <div class="form-group">
                        <label>
                            <i class="fas fa-layer-group"></i>
                            <span>日志级别</span>
                            <span class="form-hint" title="只显示该级别及以上的日志">?</span>
                        </label>
                        <div class="custom-select">
                            <select id="levelFilter" aria-label="日志级别">
                                <option value="0">全部级别</option>
                                <option value="1">DEBUG 及以上</option>
                                <option value="2" selected>INFO 及以上</option>
                                <option value="3">WARN 及以上</option>
                                <option value="4">仅 ERROR</option>
                            </select>
                            <i class="fas fa-chevron-down select-arrow"></i>
                        </div>
                    </div>

                    <!-- Search -->
                    <div class="form-group">
                        <label>
                            <i class="fas fa-search"></i>
                            <span>关键字搜索</span>
                        </label>
                        <div class="search-box">
                            <div class="search-input-wrapper">
                                <div class="input-with-icon input-with-clear input-with-history">
                                    <i class="fas fa-search input-icon"></i>
                                    <input type="text" id="keywordFilter" placeholder="搜索日志..." class="search-input" autocomplete="off">
                                    <button type="button" class="search-history-btn" id="searchHistoryBtn" title="搜索历史">
                                        <i class="fas fa-history"></i>
                                    </button>
                                    <button type="button" class="search-clear-btn" id="searchClearBtn" title="清空">
                                        <i class="fas fa-times"></i>
                                    </button>
                                    <div class="search-history-dropdown" id="searchHistoryDropdown">
                                        <div class="history-header">
                                            <span>搜索历史</span>
                                            <button type="button" class="history-clear-btn" id="historyClearBtn" title="清空历史">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                        <div class="history-list" id="historyList"></div>
                                    </div>
                                </div>
                                <button class="btn-search" id="searchBtn" title="搜索">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                            <div class="search-options-row">
                                <div class="search-options">
                                    <label class="checkbox-inline" title="正则表达式">
                                        <input type="checkbox" id="useRegex">
                                        <i class="fas fa-check check-icon"></i>
                                        <span>正则</span>
                                    </label>
                                    <label class="checkbox-inline" title="区分大小写">
                                        <input type="checkbox" id="caseSensitive">
                                        <i class="fas fa-check check-icon"></i>
                                        <span>区分大小写</span>
                                    </label>
                                </div>
                                <div class="search-info">
                                    <span class="search-count" id="searchCount"></span>
                                </div>
                                <div class="search-nav">
                                    <button class="btn-small" id="searchPrev" title="上一个">
                                        <i class="fas fa-chevron-up"></i> 上一个
                                    </button>
                                    <button class="btn-small" id="searchNext" title="下一个">
                                        <i class="fas fa-chevron-down"></i> 下一个
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Active Filters -->
                        <div class="active-filters" id="activeFilters" style="display: none;">
                            <div class="active-filters-header">
                                <i class="fas fa-filter"></i>
                                <span>活动过滤器</span>
                                <button type="button" class="btn-clear-all-filters" id="clearAllFilters">
                                    <i class="fas fa-times"></i> 清除
                                </button>
                            </div>
                            <div class="active-filters-list" id="activeFiltersList"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-tags"></i>
                            <span>Tag 过滤</span>
                        </label>
                        <div class="tag-actions">
                            <button class="btn-small" id="toggleAllTags">
                                <i class="fas fa-check-double"></i> <span>全选</span>
                            </button>
                        </div>
                        <div class="tag-list" id="tagList"></div>
                    </div>
                    
                    <!-- Settings Button -->
                    <div class="sidebar-footer">
                        <button class="btn-settings" id="btnSettings">
                            <i class="fas fa-cog"></i>
                            <span>设置</span>
                        </button>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="content">
                <!-- Hidden state checkboxes -->
                <div style="display: none;">
                    <input type="checkbox" id="autoScroll" checked>
                    <input type="checkbox" id="showTimestamp" checked>
                    <input type="checkbox" id="showLevel" checked>
                    <input type="checkbox" id="showTag" checked>
                    <input type="checkbox" id="hexMode">
                    <input type="checkbox" id="showLocation">
                    <input type="checkbox" id="autoSave">
                </div>

                <!-- Toolbar -->
                <div class="toolbar">
                    <div class="toolbar-left">
                        <button class="btn-icon" id="scrollToBottom" title="滚动到底部">
                            <i class="fas fa-arrow-down"></i>
                        </button>
                        <button class="btn-icon" id="toggleWrap" title="自动换行">
                            <i class="fas fa-align-left"></i>
                        </button>
                        <button class="btn-icon" id="increaseFont" title="增大字体">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="btn-icon" id="decreaseFont" title="减小字体">
                            <i class="fas fa-minus"></i>
                        </button>
                    </div>

                    <div class="toolbar-center">
                        <div class="display-toggles">
                            <button class="btn-toggle active" id="btnAutoScroll" title="自动滚动">
                                <i class="fas fa-angles-down"></i>
                                <span>自动滚动</span>
                            </button>
                            <button class="btn-toggle active" id="btnShowTimestamp" title="时间戳">
                                <i class="fas fa-clock"></i>
                                <span>时间戳</span>
                            </button>
                            <button class="btn-toggle active" id="btnShowLevel" title="级别">
                                <i class="fas fa-layer-group"></i>
                                <span>级别</span>
                            </button>
                            <button class="btn-toggle active" id="btnShowTag" title="Tag">
                                <i class="fas fa-tag"></i>
                                <span>Tag</span>
                            </button>
                            <button class="btn-toggle" id="btnHexMode" title="HEX模式">
                                <i class="fas fa-code"></i>
                                <span>HEX</span>
                            </button>
                            <button class="btn-toggle" id="btnShowLocation" title="文件位置">
                                <i class="fas fa-map-pin"></i>
                                <span>位置</span>
                            </button>
                            <button class="btn-toggle" id="btnAutoSave" title="自动保存">
                                <i class="fas fa-save"></i>
                                <span>保存</span>
                            </button>
                        </div>
                    </div>

                    <div class="toolbar-right">
                        <span class="info-text" id="logInfo">0 条日志</span>
                        <span class="info-text" id="filterInfo"></span>
                        <button class="btn-icon" id="toggleBookmarkPanel" title="收藏夹">
                            <i class="fas fa-bookmark"></i>
                            <span class="bookmark-badge" id="bookmarkCount">0</span>
                        </button>
                        <button class="btn-icon" id="exportBtn" title="导出日志">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="btn-icon btn-danger-icon" id="clearBtn" title="清空日志">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </div>

                <!-- Stats Bar -->
                <div class="stats-bar">
                    <div class="stat-item">
                        <span class="stat-badge" style="background: var(--level-verbose-badge); color: var(--level-verbose-fg);" id="statVERBOSE">0</span>
                        <span class="stat-label">VERBOSE</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-badge" style="background: var(--level-debug-badge); color: var(--level-debug-fg);" id="statDEBUG">0</span>
                        <span class="stat-label">DEBUG</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-badge" style="background: var(--level-info-badge); color: var(--level-info-fg);" id="statINFO">0</span>
                        <span class="stat-label">INFO</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-badge" style="background: var(--level-warn-badge); color: var(--level-warn-fg);" id="statWARN">0</span>
                        <span class="stat-label">WARN</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-badge" style="background: var(--level-error-badge); color: var(--level-error-fg);" id="statERROR">0</span>
                        <span class="stat-label">ERROR</span>
                    </div>
                    <div class="stat-divider"></div>
                    <div class="stat-item">
                        <span class="stat-badge" style="background: var(--bg-secondary); color: var(--text-primary);" id="statTotal">0</span>
                        <span class="stat-label">总计</span>
                    </div>
                    <div class="stat-divider"></div>

                    <!-- Stats bar search -->
                    <div class="qsearch" id="quickSearch">
                        <div class="qsearch__icon"><i class="fas fa-search"></i></div>
                        <input type="search" id="statSearchInput" class="qsearch__input" placeholder="搜索日志..." autocomplete="off">
                        <button type="button" class="qsearch__btn qsearch__btn--history" id="statSearchHistoryBtn" title="搜索历史"><i class="fas fa-history"></i></button>
                        <button type="button" class="qsearch__btn qsearch__btn--clear" id="statSearchClear" title="清空"><i class="fas fa-times"></i></button>
                        <span class="qsearch__divider"></span>
                        <button type="button" class="qsearch__btn qsearch__btn--nav" id="statSearchPrev" title="上一个"><i class="fas fa-chevron-up"></i></button>
                        <button type="button" class="qsearch__btn qsearch__btn--nav" id="statSearchNext" title="下一个"><i class="fas fa-chevron-down"></i></button>
                        <span class="qsearch__count" id="statSearchCount">0/0</span>
                        <!-- History dropdown -->
                        <div class="qsearch__dropdown" id="statSearchHistoryDropdown">
                            <div class="qsearch__dropdown-header">
                                <span>搜索历史</span>
                                <button type="button" class="history-clear-btn" id="statHistoryClearBtn" title="清空"><i class="fas fa-trash"></i></button>
                            </div>
                            <div class="history-list" id="statHistoryList"></div>
                        </div>
                    </div>
                </div>

                <!-- Log Table -->
                <div class="log-table-container" id="logContainer">
                    <table class="log-table" id="logTable">
                        <thead id="logHead">
                            <tr>
                                <th class="col-index"><i class="fas fa-hashtag"></i></th>
                                <th class="col-time"><i class="fas fa-clock"></i> 时间</th>
                                <th class="col-level"><i class="fas fa-signal"></i> 级别</th>
                                <th class="col-tag"><i class="fas fa-tag"></i> Tag</th>
                                <th class="col-message"><i class="fas fa-align-left"></i> 消息</th>
                                <th class="col-action"><i class="fas fa-ellipsis-h"></i></th>
                            </tr>
                        </thead>
                        <tbody id="logBody"></tbody>
                    </table>
                    <div class="empty-state" id="emptyState">
                        <div class="empty-icon">
                            <i class="fas fa-satellite-dish"></i>
                        </div>
                        <p>暂无日志数据</p>
                        <p class="empty-hint">连接串口后开始接收日志</p>
                    </div>
                    
                    <div class="new-data-toast" id="newDataToast" style="display: none;">
                        <i class="fas fa-arrow-down"></i>
                        <span>有新日志</span>
                        <button class="btn-small" id="jumpToNew">查看</button>
                    </div>
                </div>

                <!-- Send Panel -->
                <div class="send-panel" id="sendPanel">
                    <div class="send-input-wrapper">
                        <div class="send-options">
                            <label class="checkbox-inline">
                                <input type="checkbox" id="sendHex">
                                <i class="fas fa-check check-icon"></i>
                                <span>HEX</span>
                            </label>
                            <label class="checkbox-inline">
                                <input type="checkbox" id="sendNewline" checked>
                                <i class="fas fa-check check-icon"></i>
                                <span>换行</span>
                            </label>
                            <label class="checkbox-inline">
                                <input type="checkbox" id="loopSend">
                                <i class="fas fa-check check-icon"></i>
                                <span>循环</span>
                            </label>
                            <input type="number" id="loopInterval" value="1000" min="100" step="100" class="small-input" title="循环间隔(ms)">
                            <span style="font-size: 10px; color: var(--text-hint);">ms</span>
                        </div>
                        <div class="input-row">
                            <input type="text" id="sendInput" placeholder="输入要发送的数据..." aria-label="发送数据">
                            <button class="btn-primary" id="sendBtn">
                                <i class="fas fa-paper-plane"></i>
                                发送
                            </button>
                        </div>
                    </div>
                    <div class="quick-commands" id="quickCommands">
                        <span class="quick-label">快捷:</span>
                        <button class="btn-chip" data-cmd="help">help</button>
                        <button class="btn-chip" data-cmd="status">status</button>
                        <button class="btn-chip" data-cmd="reset">reset</button>
                        <button class="btn-chip" data-cmd="info">info</button>
                    </div>
                </div>
            </main>

            <!-- Bookmark Panel -->
            <aside class="bookmark-panel" id="bookmarkPanel" style="display: none;">
                <div class="panel-header">
                    <h3 class="panel-title" style="margin-bottom: 0; padding-bottom: 0; border-bottom: none;">
                        <i class="fas fa-bookmark"></i>
                        <span>固定日志</span>
                    </h3>
                    <button class="btn-icon" id="closeBookmarkPanel" title="关闭">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="bookmark-list" id="bookmarkList"></div>
            </aside>
        </div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu" style="display: none;">
        <div class="menu-item" id="ctxBookmark">
            <i class="fas fa-bookmark"></i>
            <span>固定日志</span>
        </div>
        <div class="menu-item" id="ctxCopy">
            <i class="fas fa-copy"></i>
            <span>复制内容</span>
        </div>
        <div class="menu-item" id="ctxCopyRow">
            <i class="fas fa-clipboard"></i>
            <span>复制整行</span>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-item" id="ctxFilterTag">
            <i class="fas fa-tag"></i>
            <span>过滤此 Tag</span>
        </div>
        <div class="menu-item" id="ctxFilterLevel">
            <i class="fas fa-layer-group"></i>
            <span>过滤此级别</span>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-cog"></i> 设置</h2>
                <button class="btn-close" id="closeSettings">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3><i class="fas fa-folder-open"></i> 保存路径</h3>
                    <div class="settings-row">
                        <div class="settings-input-group">
                            <input type="text" id="savePathInput" class="settings-input" readonly placeholder="选择保存路径...">
                            <button class="btn-primary" id="browseSavePath">
                                <i class="fas fa-folder-open"></i> 浏览
                            </button>
                        </div>
                        <p class="settings-hint">
                            <i class="fas fa-info-circle"></i> 
                            日志文件将保存到此目录。留空则使用默认路径。
                        </p>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3><i class="fas fa-file-export"></i> 导出设置</h3>
                    <div class="settings-row">
                        <label class="settings-label">
                            <span>默认导出格式</span>
                        </label>
                        <div class="custom-select">
                            <select id="defaultExportFormat" aria-label="默认导出格式">
                                <option value="txt" selected>TXT 文本</option>
                                <option value="csv">CSV 表格</option>
                                <option value="json">JSON 数据</option>
                            </select>
                            <i class="fas fa-chevron-down select-arrow"></i>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3><i class="fas fa-clock"></i> 自动保存</h3>
                    <div class="settings-row">
                        <label class="settings-label">
                            <span>自动保存间隔（秒）</span>
                        </label>
                        <input type="number" id="autoSaveInterval" class="settings-input" value="30" min="10" max="300" step="10">
                        <p class="settings-hint">
                            <i class="fas fa-info-circle"></i> 
                            启用自动保存后，每隔指定时间自动保存日志。
                        </p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="resetSettings">
                    <i class="fas fa-undo"></i> 恢复默认
                </button>
                <button class="btn-primary" id="saveSettings">
                    <i class="fas fa-save"></i> 保存设置
                </button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
