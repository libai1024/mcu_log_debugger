# MCU Log Debugger v1.0.1 开发路线图

## 📋 版本信息

- **版本号**: v1.0.1
- **开发周期**: 2026-02-08 ~ 2026-02-15 (预计)
- **发布类型**: 功能增强 + Bug 修复
- **基于版本**: v1.0.0

---

## 🎯 核心目标

1. **增强显示模式** - 支持三种模式自由切换
2. **优化设置入口** - 提升用户体验
3. **功能评审改进** - 向主流串口助手靠近
4. **性能和稳定性** - Bug 修复和优化

---

## 📦 功能规划

### 1. 三种显示模式切换 🔄

#### 1.1 Log 模式（当前默认）
**特点**: 结构化日志显示
- ✅ 已实现: 时间戳、级别、Tag、消息、位置
- ✅ 已实现: 颜色编码、级别过滤
- 🔧 改进: 添加模式切换按钮
- 🔧 改进: 优化表格布局

#### 1.2 HEX 模式
**特点**: 十六进制数据查看
- ✅ 已实现: 基本 HEX 显示
- 🆕 新增: 地址偏移显示
- 🆕 新增: ASCII 对照显示
- 🆕 新增: 数据分组（8/16 字节）
- 🆕 新增: 高亮选中数据

**布局设计**:
```
地址      | HEX 数据                                    | ASCII
---------|---------------------------------------------|--------
00000000 | 5B 30 30 3A 30 30 3A 30 30 2E 30 30 30 5D | [00:00:00.000]
00000010 | 20 5B 49 4E 46 4F 5D 20 5B 4D 41 49 4E 5D |  [INFO] [MAIN]
```

#### 1.3 Normal 模式（纯文本）
**特点**: 原始数据流显示
- 🆕 新增: 无格式化的原始数据
- 🆕 新增: 类似终端的显示效果
- 🆕 新增: 支持 ANSI 颜色码（可选）
- 🆕 新增: 自动滚动和自动换行

**使用场景**:
- 查看原始串口数据
- 调试通信协议
- 查看非结构化输出

---

### 2. 设置入口优化 ⚙️

#### 2.1 当前状态
- ❌ 设置按钮在侧边栏底部
- ❌ 不够显眼
- ❌ 与主流应用习惯不符

#### 2.2 改进方案
- ✅ 移至右上角工具栏
- ✅ 使用齿轮图标
- ✅ 添加快捷键 `Cmd/Ctrl + ,`
- ✅ 悬停显示 Tooltip

**位置示意**:
```
┌─────────────────────────────────────────────────┐
│  MCU Log Debugger           🌙  ⚙️  ❓  ✕      │  <- 右上角
├─────────────────────────────────────────────────┤
│  [工具栏]                                        │
│  ...                                            │
```

---

### 3. 视图锁定功能 🔒 ⭐

#### 3.1 功能概述

**核心需求**: 在搜索或手动锁定时，冻结日志视图，防止新消息干扰用户查看。

#### 3.2 触发场景

**自动锁定**:
1. 用户开始搜索时自动锁定
2. 用户关闭自动滚动时锁定
3. 用户手动滚动到非底部位置时锁定

**手动锁定**:
- 工具栏添加锁定按钮 🔒/🔓
- 快捷键: `Cmd/Ctrl + L`

#### 3.3 锁定状态行为

**视图行为**:
- ✅ 停止自动滚动
- ✅ 保持当前滚动位置
- ✅ 新消息在后台累积，不影响显示
- ✅ 搜索结果高亮保持可见

**新消息提示**:
```
┌─────────────────────────────────────────────────┐
│                                                 │
│  [日志显示区域 - 已锁定]                         │
│                                                 │
│                                    ┌──────────┐ │
│                                    │ 🔒 已锁定 │ │
│                                    │ +23 条新  │ │
│                                    │ [解锁]    │ │
│                                    └──────────┘ │
└─────────────────────────────────────────────────┘
```

**提示卡片位置**: 右下角悬浮
**提示内容**:
- 锁定图标 🔒
- 新消息数量（累加）
- 解锁按钮

#### 3.4 解锁行为

**解锁方式**:
1. 点击提示卡片的"解锁"按钮
2. 点击工具栏锁定按钮
3. 按快捷键 `Cmd/Ctrl + L`
4. 点击"跳转到底部"按钮

**解锁后**:
- ✅ 显示所有累积的新消息
- ✅ 自动滚动到最新消息（如果之前启用了自动滚动）
- ✅ 清除新消息计数
- ✅ 移除锁定提示卡片

#### 3.5 UI 设计

**锁定按钮**:
```
[🔒 锁定] / [🔓 已解锁]
```

**提示卡片**:
```css
.lock-notification {
    position: fixed;
    right: 24px;
    bottom: 24px;
    background: var(--bg-primary);
    border: 2px solid var(--primary);
    border-radius: var(--radius-md);
    padding: 16px;
    box-shadow: var(--shadow-lg);
    z-index: 1000;
    animation: slideIn 0.3s ease;
}
```

**内容结构**:
```html
<div class="lock-notification">
    <div class="lock-icon">🔒</div>
    <div class="lock-text">视图已锁定</div>
    <div class="new-count">+23 条新消息</div>
    <button class="btn-unlock">解锁并查看</button>
</div>
```

#### 3.6 状态管理

```javascript
// 锁定状态
let isViewLocked = false;
let newMessagesWhileLocked = 0;
let lockReason = null; // 'search' | 'manual' | 'auto-scroll-off' | 'user-scroll'

// 锁定函数
function lockView(reason) {
    isViewLocked = true;
    lockReason = reason;
    newMessagesWhileLocked = 0;
    updateLockUI();
}

// 解锁函数
function unlockView() {
    isViewLocked = false;
    lockReason = null;
    newMessagesWhileLocked = 0;
    updateLockUI();
    
    // 如果自动滚动开启，滚动到底部
    if (autoScroll) {
        scrollToBottom();
    }
}

// 接收新消息时
function onNewMessage(message) {
    allEntries.push(message);
    
    if (isViewLocked) {
        newMessagesWhileLocked++;
        updateLockNotification();
    } else {
        renderLogTable();
        if (autoScroll) {
            scrollToBottom();
        }
    }
}
```

#### 3.7 与现有功能集成

**搜索功能**:
- 开始搜索 → 自动锁定
- 清除搜索 → 询问是否解锁

**自动滚动**:
- 关闭自动滚动 → 自动锁定
- 开启自动滚动 → 自动解锁

**用户滚动**:
- 滚动到非底部 → 自动锁定
- 滚动到底部 → 自动解锁

---

### 3. 功能评审与改进 🔍

#### 3.1 参考主流串口助手

**对标产品**:
- Serial Port Monitor (Windows)
- CoolTerm (跨平台)
- Termite (Windows)
- minicom (Linux)
- Serial Studio (跨平台)

#### 3.2 功能对比分析

| 功能 | 当前状态 | 主流助手 | 改进方向 |
|------|---------|---------|---------|
| 串口连接 | ✅ 基础功能 | ✅ | 添加连接历史 |
| 数据显示 | ✅ Log 模式 | ✅ 多模式 | 添加 HEX/Normal |
| 数据发送 | ⚠️ 基础面板 | ✅ 丰富 | 增强发送功能 |
| 数据保存 | ✅ 导出 | ✅ | 添加实时保存 |
| 时间戳 | ✅ 协议内置 | ✅ 可选 | 添加本地时间戳 |
| 统计信息 | ✅ 基础统计 | ✅ | 添加速率统计 |
| 宏命令 | ❌ 无 | ✅ | v1.1.0 计划 |
| 脚本支持 | ❌ 无 | ⚠️ 部分 | v1.2.0 计划 |

#### 3.3 UI/UX 改进建议

**3.3.1 工具栏优化**
- 🔧 添加快速操作按钮
- 🔧 图标 + 文字标签（可配置）
- 🔧 分组和分隔符
- 🔧 响应式布局

**3.3.2 状态栏增强**
```
当前: [统计信息] [搜索框]
改进: [连接状态] [速率] [统计] [进度] [搜索]
```

**3.3.3 侧边栏改进**
- 🔧 可折叠/展开
- 🔧 宽度可调整
- 🔧 标签页切换（过滤/发送/书签）

**3.3.4 快捷键支持**
```
Cmd/Ctrl + K     - 清空日志
Cmd/Ctrl + F     - 搜索
Cmd/Ctrl + ,     - 设置
Cmd/Ctrl + S     - 保存
Cmd/Ctrl + Enter - 发送数据
Cmd/Ctrl + 1/2/3 - 切换模式
```

---

## 🐛 Bug 修复计划

### 高优先级
1. ✅ Tag 过滤状态同步问题 (已修复)
2. ✅ 表头列对齐问题 (已修复)
3. ⚠️ 大量数据时性能下降
4. ⚠️ 自动滚动偶尔失效

### 中优先级
1. 设置保存路径在 Windows 上的兼容性
2. 虚拟串口检测在某些系统上失败
3. 搜索结果高亮不准确

### 低优先级
1. 主题切换动画不流畅
2. 某些图标显示不一致
3. 工具提示文本需要优化

---

## 🎨 UI 改进详细设计

### 模式切换器设计

**位置**: 工具栏左侧
**样式**: 分段控制器（Segmented Control）

```
┌─────────────────────────────────────┐
│  📝 Log  │  🔢 HEX  │  📄 Normal   │
└─────────────────────────────────────┘
```

**交互**:
- 点击切换模式
- 保存用户偏好
- 平滑过渡动画
- 快捷键支持

### 设置图标设计

**位置**: 右上角工具栏
**图标**: ⚙️ (齿轮)
**大小**: 20x20px
**颜色**: 跟随主题

**悬停效果**:
- 轻微放大 (1.1x)
- 颜色高亮
- 显示 Tooltip: "设置 (Cmd+,)"

---

## 📊 性能优化

### 1. 虚拟滚动优化
- 当前: 渲染最近 300 条
- 优化: 动态计算可见区域
- 目标: 支持 10000+ 条流畅显示

### 2. 数据处理优化
- 使用 Web Worker 处理日志解析
- 批量更新 DOM
- 防抖和节流

### 3. 内存管理
- 限制最大日志条数
- 自动清理旧数据
- 优化数据结构

---

## 🧪 测试计划

### 单元测试
- [ ] 模式切换逻辑
- [ ] HEX 数据格式化
- [ ] 设置持久化

### 集成测试
- [ ] 串口通信
- [ ] 数据导出
- [ ] 跨平台兼容性

### 性能测试
- [ ] 大量数据处理
- [ ] 内存占用
- [ ] CPU 使用率

### 用户测试
- [ ] UI/UX 可用性
- [ ] 功能完整性
- [ ] 文档准确性

---

## 📅 开发时间表

### Week 1 (2026-02-08 ~ 2026-02-11)

**Day 1: 模式切换基础**
- [ ] 设计模式切换器 UI
- [ ] 实现模式状态管理
- [ ] 添加模式切换动画
- [ ] 实现模式持久化

**Day 2: 视图锁定功能** ⭐
- [ ] 实现锁定状态管理
- [ ] 添加锁定按钮和快捷键
- [ ] 实现新消息累积逻辑
- [ ] 设计锁定通知卡片
- [ ] 集成搜索、自动滚动、用户滚动触发

**Day 3: HEX 模式实现**
- [ ] 实现 HEX 数据格式化
- [ ] 添加地址偏移显示
- [ ] 实现 ASCII 对照
- [ ] 添加数据分组选项（8/16/32 字节）

**Day 4: Normal 模式实现**
- [ ] 实现纯文本显示
- [ ] 添加 ANSI 颜色支持（可选）
- [ ] 优化渲染性能
- [ ] 测试三种模式切换

**Day 5: 设置入口优化**
- [ ] 移动设置按钮到右上角
- [ ] 添加帮助按钮
- [ ] 实现快捷键 Cmd/Ctrl + ,
- [ ] 优化设置界面布局

### Week 2 (2026-02-12 ~ 2026-02-15)

**Day 1: UI/UX 改进**
- [ ] 工具栏重新设计
- [ ] 状态栏增强（速率、统计）
- [ ] 优化按钮布局和分组
- [ ] 添加更多快捷键

**Day 2: 性能优化**
- [ ] 优化虚拟滚动
- [ ] 批量 DOM 更新
- [ ] 防抖和节流优化
- [ ] 内存管理优化

**Day 3: Bug 修复**
- [ ] 修复已知 Bug
- [ ] 测试边界情况
- [ ] 代码重构和清理

**Day 4: 完整测试**
- [ ] 功能测试
- [ ] 性能测试
- [ ] 跨平台测试
- [ ] 用户体验测试

**Day 5: 文档和发布**
- [ ] 更新文档
- [ ] 编写 CHANGELOG
- [ ] 准备发布说明
- [ ] 创建 Release

---

## ✅ 验收标准

### 功能完整性
- [ ] 三种模式都能正常工作
- [ ] 模式切换流畅无卡顿
- [ ] 设置入口易于访问
- [ ] 所有快捷键正常工作

### 性能指标
- [ ] 10000 条日志流畅显示
- [ ] 模式切换 < 100ms
- [ ] 内存占用 < 200MB
- [ ] CPU 使用率 < 10%

### 用户体验
- [ ] UI 美观现代
- [ ] 操作直观易懂
- [ ] 响应迅速
- [ ] 错误提示友好

### 兼容性
- [ ] macOS 10.15+
- [ ] Windows 10+
- [ ] Linux (Ubuntu 20.04+)

---

## 📝 发布清单

- [ ] 代码审查完成
- [ ] 所有测试通过
- [ ] 文档更新完成
- [ ] CHANGELOG 编写
- [ ] 版本号更新
- [ ] 构建所有平台安装包
- [ ] GitHub Release 创建
- [ ] 发布说明编写

---

## 🔗 相关文档

- [功能评审](FEATURE_REVIEW.md)
- [UI 改进计划](UI_IMPROVEMENTS.md)
- [技术实现细节](TECHNICAL_DETAILS.md)

---

**最后更新**: 2026-02-08
**负责人**: 开发团队
**状态**: 🚧 进行中
