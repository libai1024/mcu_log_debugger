# è™šæ‹Ÿä¸²å£è®¾ç½®æŒ‡å—

## é—®é¢˜è¯´æ˜

Tauriåº”ç”¨ç°åœ¨**å·²æ”¯æŒ**æ£€æµ‹è™šæ‹Ÿä¸²å£ï¼ˆsocatåˆ›å»ºçš„ `/dev/ttys*` è®¾å¤‡ï¼‰ã€‚

### ä¿®å¤å†…å®¹

1. **ä¸²å£åˆ—è¡¨æ‰«æ** - é™¤äº†ç¡¬ä»¶ä¸²å£ï¼Œç°åœ¨è¿˜ä¼šæ‰«æï¼š
   - macOS: `/dev/ttys*` (socatè™šæ‹Ÿä¸²å£)
   - macOS: `/dev/ptyp*` (å…¶ä»–è™šæ‹Ÿä¸²å£)
   - Linux: `/dev/pts/*` (è™šæ‹Ÿç»ˆç«¯)

2. **è™šæ‹Ÿä¸²å£æ”¯æŒ** - å¯¹è™šæ‹ŸPTYè®¾å¤‡ä½¿ç”¨æ ‡å‡†æ–‡ä»¶I/Oè€Œä¸æ˜¯ä¸²å£é…ç½®ï¼Œé¿å… "Not a typewriter" é”™è¯¯

---

## ğŸš€ å®Œæ•´æµ‹è¯•æµç¨‹

### æ­¥éª¤1: åˆ›å»ºè™šæ‹Ÿä¸²å£å¯¹

**ç»ˆç«¯1** - è¿è¡Œsocatï¼ˆä¿æŒè¿è¡Œï¼‰ï¼š
```bash
socat -d -d pty,raw,echo=0 pty,raw,echo=0
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
2026/02/08 17:01:20 socat[43079] N PTY is /dev/ttys019
2026/02/08 17:01:20 socat[43079] N PTY is /dev/ttys020
```

è®°ä¸‹è¿™ä¸¤ä¸ªä¸²å£ï¼š
- `/dev/ttys019` - ç”¨äºæ—¥å¿—æ¨¡æ‹Ÿå™¨
- `/dev/ttys020` - ç”¨äºMCUæ—¥å¿—åŠ©æ‰‹

### æ­¥éª¤2: å¯åŠ¨æ—¥å¿—æ¨¡æ‹Ÿå™¨

**ç»ˆç«¯2** - è¿è¡ŒPythonæ¨¡æ‹Ÿå™¨ï¼š
```bash
cd /Users/wangwei/Desktop/Projects/log_stm32_helper

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆå¦‚æœè¿˜æ²¡æœ‰è®¾ç½®ï¼‰
source venv/bin/activate

# å¯åŠ¨æ¨¡æ‹Ÿå™¨ï¼ˆä½¿ç”¨ç¬¬ä¸€ä¸ªä¸²å£ï¼‰
python3 test_log_simulator.py --port /dev/ttys019 --mode continuous
```

### æ­¥éª¤3: å¯åŠ¨Tauriåº”ç”¨

**ç»ˆç«¯3** - å¯åŠ¨åº”ç”¨ï¼š
```bash
cd /Users/wangwei/Desktop/Projects/log_stm32_helper

# å¯åŠ¨å¼€å‘æ¨¡å¼
npm run tauri dev
```

### æ­¥éª¤4: è¿æ¥ä¸²å£

åœ¨MCUæ—¥å¿—åŠ©æ‰‹åº”ç”¨ä¸­ï¼š
1. ç‚¹å‡»"ä¸²å£"ä¸‹æ‹‰æ¡†
2. é€‰æ‹© `/dev/ttys020`ï¼ˆsocatçš„ç¬¬äºŒä¸ªä¸²å£ï¼‰
3. ç‚¹å‡»"è¿æ¥ä¸²å£"
4. è§‚å¯Ÿæ—¥å¿—å®æ—¶æ˜¾ç¤ºï¼

---

## âœ… éªŒè¯æ¸…å•

- [ ] socatæ­£åœ¨è¿è¡Œä¸”æ˜¾ç¤ºä¸¤ä¸ªPTYè·¯å¾„
- [ ] Pythonæ¨¡æ‹Ÿå™¨å·²è¿æ¥åˆ°ç¬¬ä¸€ä¸ªä¸²å£
- [ ] Tauriåº”ç”¨å·²å¯åŠ¨
- [ ] åº”ç”¨çš„ä¸²å£ä¸‹æ‹‰æ¡†ä¸­èƒ½çœ‹åˆ° `/dev/ttys020`
- [ ] ç‚¹å‡»è¿æ¥åçŠ¶æ€å˜ä¸º"å·²è¿æ¥"
- [ ] æ—¥å¿—å®æ—¶æ˜¾ç¤ºåœ¨è¡¨æ ¼ä¸­

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1: åº”ç”¨ä¸­çœ‹ä¸åˆ°è™šæ‹Ÿä¸²å£

**åŸå› **: éœ€è¦é‡æ–°ç¼–è¯‘Tauriåº”ç”¨ä»¥åŒ…å«æ–°çš„ä¸²å£æ‰«æä»£ç 

**è§£å†³æ–¹æ¡ˆ**:
```bash
cd /Users/wangwei/Desktop/Projects/log_stm32_helper
cargo build --manifest-path src-tauri/Cargo.toml
npm run tauri dev
```

### é—®é¢˜2: "Not a typewriter" é”™è¯¯

**åŸå› **: æ—§ç‰ˆæœ¬ä»£ç å°è¯•å¯¹PTYè®¾å¤‡è®¾ç½®ä¸²å£å‚æ•°

**è§£å†³æ–¹æ¡ˆ**: å·²ä¿®å¤ï¼Œè™šæ‹Ÿä¸²å£ç°åœ¨ä½¿ç”¨æ ‡å‡†æ–‡ä»¶I/O

### é—®é¢˜3: è¿æ¥åæ— æ—¥å¿—æ˜¾ç¤º

**æ£€æŸ¥**:
1. ç¡®è®¤æ¨¡æ‹Ÿå™¨æ­£åœ¨è¿è¡Œä¸”æ²¡æœ‰é”™è¯¯
2. ç¡®è®¤ä½¿ç”¨äº†æ­£ç¡®çš„ä¸²å£å¯¹ï¼ˆä¸€ä¸ªç»™æ¨¡æ‹Ÿå™¨ï¼Œä¸€ä¸ªç»™åº”ç”¨ï¼‰
3. æ£€æŸ¥socatæ˜¯å¦ä»åœ¨è¿è¡Œ

### é—®é¢˜4: ä¸²å£åˆ—è¡¨ä¸ºç©º

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥ /dev ç›®å½•
ls /dev/ttys* /dev/cu.* 2>/dev/null

# å¦‚æœçœ‹åˆ° ttys* ä½†åº”ç”¨ä¸­çœ‹ä¸åˆ°ï¼Œé‡å¯åº”ç”¨
```

---

## ğŸ“Š æµ‹è¯•åœºæ™¯

### å¿«é€Ÿæµ‹è¯•ï¼ˆåœºæ™¯æ¨¡å¼ï¼‰
```bash
# ç»ˆç«¯1: socat
socat -d -d pty,raw,echo=0 pty,raw,echo=0

# ç»ˆç«¯2: æ¨¡æ‹Ÿå™¨ï¼ˆä½¿ç”¨socatè¾“å‡ºçš„ç¬¬ä¸€ä¸ªä¸²å£ï¼‰
python3 test_log_simulator.py --port /dev/ttys019

# ç»ˆç«¯3: åº”ç”¨
npm run tauri dev
# è¿æ¥åˆ°ç¬¬äºŒä¸ªä¸²å£ /dev/ttys020
```

### æŒç»­æµ‹è¯•
```bash
# æ¨¡æ‹Ÿå™¨æŒç»­å‘é€
python3 test_log_simulator.py --port /dev/ttys019 --mode continuous
```

### å‹åŠ›æµ‹è¯•
```bash
# çªå‘æ¨¡å¼
python3 test_log_simulator.py --port /dev/ttys019 --mode continuous --burst
```

---

## ğŸ’¡ æŠ€æœ¯ç»†èŠ‚

### ä¸ºä»€ä¹ˆéœ€è¦ç‰¹æ®Šå¤„ç†ï¼Ÿ

1. **çœŸå®ä¸²å£** (å¦‚ `/dev/cu.usbserial-*`):
   - æ”¯æŒæ³¢ç‰¹ç‡ã€æ•°æ®ä½ã€åœæ­¢ä½ç­‰é…ç½®
   - ä½¿ç”¨ `serialport` crate çš„å®Œæ•´åŠŸèƒ½

2. **è™šæ‹Ÿä¸²å£** (å¦‚ `/dev/ttys*`):
   - ä¸æ”¯æŒä¸²å£ç‰¹å®šçš„ioctlè°ƒç”¨
   - éœ€è¦ä½¿ç”¨æ ‡å‡†æ–‡ä»¶I/Oï¼ˆ`BufReader`ï¼‰
   - æ³¢ç‰¹ç‡ç­‰å‚æ•°è¢«å¿½ç•¥ï¼ˆå› ä¸ºæ˜¯å†…å­˜ç®¡é“ï¼‰

### ä»£ç å®ç°

```rust
// æ£€æµ‹è™šæ‹Ÿä¸²å£
fn is_virtual_port(path: &str) -> bool {
    path.contains("/ttys") || path.contains("/ptyp") || path.contains("/pts/")
}

// æ ¹æ®ç±»å‹é€‰æ‹©è¯»å–æ–¹å¼
if is_virtual {
    read_virtual_port(port_name, running, window);  // æ ‡å‡†æ–‡ä»¶I/O
} else {
    read_real_port(port_name, baud_rate, running, window);  // serialport crate
}
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

ç°åœ¨ä½ å¯ä»¥ï¼š
1. é‡å¯Tauriåº”ç”¨ï¼ˆå¦‚æœæ­£åœ¨è¿è¡Œï¼‰
2. åˆ·æ–°ä¸²å£åˆ—è¡¨ï¼ˆç‚¹å‡»åˆ·æ–°æŒ‰é’®ï¼‰
3. åº”è¯¥èƒ½çœ‹åˆ° `/dev/ttys020` äº†
4. è¿æ¥å¹¶å¼€å§‹æµ‹è¯•ï¼

å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
- socatæ˜¯å¦æ­£åœ¨è¿è¡Œ
- ä½¿ç”¨çš„ä¸²å£è·¯å¾„æ˜¯å¦æ­£ç¡®
- æŸ¥çœ‹ç»ˆç«¯è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯
